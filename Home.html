<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
    <link rel="shortcut icon" type="image/jpg" href="https://cdn.iconscout.com/icon/premium/png-256-thumb/expense-tracker-app-4203120-3509061.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="Home.css" />
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-base.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-exports.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4"></script>
    <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-ui.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
      integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>

  <body>
   <div id="loader"></div>
    <div id="myDiv" style="display: none;">
      <h1 id="main-heading">Expense Tracker</h1>
      <div class="container-fluid">
        <div class="row">
          <!-- //left column -->
          <div class="col-lg-6 left">
            <!-- container1-l -->
            <div class="container1-l">
              <div>
                <strong><h3>Add Transactions</h3></strong>
              </div>
              <input type="number" id="ammount-input" placeholder="Enter Ammount" min="0" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))" />
              <label for="bank-select"></label>
              <select name="bank-select" id="bank-select"></select>
              <input type="radio" id="expenseradio" name="division" value="Expense" />
              <h1 id="expensevalue" style="display: none;">00</h1>
              <button disabled id="expensebtn" value="expensebtn">
                <i class="fa-solid fa-wallet"><br /></i>Expense
              </button>
              <input type="radio" id="incomeradio" name="division" value="incomebtn" />
              <h1 id="incomevalue" style="display: none;">00</h1>
              <button disabled id="incomebtn" value="Incomebtn"><i class="fa-solid fa-money-bill"></i>Income</button>
            </div>

            <br />
            <div class="container2-l">
              <div style="margin-left: 50px;">
                <strong><h4>Choose the Category</h4></strong>
              </div>
              <div id="expen-icon">
                <button disabled>
                  <i class="fa-sharp fa-solid fa-house"></i>
                </button>
                <button disabled>
                  <i class="fa-solid fa-cart-shopping"></i>
                </button>
                <button disabled><i class="fa-solid fa-gift"></i></button>
                <button disabled><i class="fa-solid fa-utensils"></i></button>
                <button disabled>
                  <i class="fa-solid fa-notes-medical"></i>
                </button>
              </div>
              <div id="expen-selection">
                <input type="radio" id="house" name="expandivision" value="housebtn" />
                <input type="radio" id="shopping" name="expandivision" value="shoppingbtn" />
                <input type="radio" id="gift" name="expandivision" value="giftbtn" />
                <input type="radio" id="dinner" name="expandivision" value="dinnerbtn" />
                <input type="radio" id="medical" name="expandivision" value="medicalbtn" />
              </div>
              <div id="expen-title">
                <strong>
                  <span>Home</span>
                  <span>Shopping</span>
                  <span>Gift</span>
                  <span>Dinner</span>
                  <span>Medical</span>
                </strong>
              </div>
              <div id="expen-add"><button>Add</button></div>
            </div>

            <!-- left table -->
            <div class="container3-l">
              <div class="table-l">
                <br />
                <strong>
                  <h4 style="margin-left: 50px;">Transaction History</h4>
                </strong>
                <div id="table1" class="scroll1">
                  <table style="background-color: white;"></table>
                </div>
              </div>
            </div>
          </div>

          <!-- right column -->
          <div class="col-lg-6 right">
            <div class="container1-r">
              <div class="nav" >
                <div id="welcome">
              
               </div>
                <button id="fa-user"><i class="fa-solid fa-user"></i></button>
               
              </div>
              <br />
              <div>
                <strong><span id="havetotal">What you Have?</span></strong>
              </div>
            </div>
            <div class="container2-r">
              <h2 id="balance">1000</h2>
            </div>
            <div class="container3-r">
              <div id="table2">
                <table style="background-color: white;">
                  <tr>
                    <th>Cash</th>
                    <th>Bank</th>
                    <th>Saving</th>
                  </tr>
                  <tr style="color: rgb(55, 115, 236); font-weight: bold;">
                    <td id="table2-cash">1000</td>
                    <td id="table2-bank">00</td>
                    <td id="table2-saving">00</td>
                  </tr>
                </table>
              </div>
            </div>

            <div class="add-bank">
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@getbootstrap">
                Click to add Bank
              </button>
              <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">
                        Add Bank
                      </h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="mb-3">
                          <label for="recipient-name" class="col-form-label">Enter Account Name</label>
                          <input type="text" class="form-control" id="bank-name" />
                        </div>
                        <div class="mb-3">
                          <label for="recipient-name" class="col-form-label">Enter Ammount</label>
                          <input type="number" class="form-control" id="ammount" min="0" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))" />
                        </div>
                      </form>
                    </div>
                    <div id="alert" class="alert"></div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="submitbtn">
                        Submit
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <select name="bank-select" id="bank-select1"></select>
            </div>

            <div class="container4-r">
              <div class="scroll">
                <table id="table3">
                  <tr>
                    <th>Cash</th>
                    <td id="table3-cash">1000</td>
                  </tr>
                  <tr>
                    <th>Saving</th>
                    <td id="table3-saving">00</td>
                  </tr>
                  <tr style="display: none;">
                    <td id="table3-bank">00</td>
                  </tr>
                </table>
              </div>

              <br />
              <h3>Overview</h3>
              <div id="container-chart"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="app.js"></script>
</html>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-analytics.js";
  import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
  import { getFirestore, deleteDoc, addDoc, collection, doc, getDoc, query, where, getDocs, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";
  const firebaseConfig = {
    apiKey: "AIzaSyAo0FGzNytdWQ0RRq6eUeogVHDO2ejByS8",
    authDomain: "egpro-9bb13.firebaseapp.com",
    projectId: "egpro-9bb13",
    storageBucket: "egpro-9bb13.appspot.com",
    messagingSenderId: "330781414809",
    appId: "1:330781414809:web:47e8d1ab035a04e2e5af08",
    measurementId: "G-MGXQYBY2V4",
  };

  let banksarr = ["Cash", "Savings"];
  let transactionhistory = [];
  let banknamearray = [];
  let calculationarray = [];
  let othercalculation = { Expense: "", Income: "" };
  const useremail = localStorage.getItem("useremail");
  let expensestorage;
  let incomestorage;

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);

    var myVar;
  const myFunction = async function () {
    myVar = setTimeout(showPage, 2000);

  }

    function showPage() {
    document.getElementById("loader").style.display = "none";
    document.getElementById("myDiv").style.display = "contents";
  }


  addEventListener("DOMContentLoaded", async () => {
    const docRef = doc(db, "users/", useremail);
    const docSnap = await getDoc(docRef);

    myFunction()

    if (docSnap.exists()) {
      const userdata = docSnap.data();
      console.log(userdata);
      othercalculation = userdata.othercalculations;
      banksarr = userdata.banksarr;
      transactionhistory = userdata.transactionhistory;
      banknamearray = userdata.banknamearray;
      calculationarray = userdata.calculationarray;
      expensestorage = userdata.othercalculations.Expense;
      incomestorage = userdata.othercalculations.Income;
      console.log(expensestorage, incomestorage);

              document.getElementById('welcome').innerHTML = `<h4>Welcome ${userdata.name}</h4>`



      let i = 0;
      while (i < userdata.banksarr.length) {
        let myTable1 = document.getElementById("table3");
        const bankvalue = banksarr.length - 1;
        const sel = document.getElementById("bank-select");
        const opt = document.createElement("option");
        const sel1 = document.getElementById("bank-select1");
        const opt1 = document.createElement("option");

        opt.text = banksarr[i];
        sel.add(opt, sel.options[bankvalue]);
        opt1.text = banksarr[i];
        sel1.add(opt1, sel1.options[bankvalue]);

        i++;
      }
      if (userdata.banknamearray.length > 2) {
        let myTable = document.getElementById("table2");
        let myTable1 = document.getElementById("table3");

        let b = 2;
        while (b < userdata.banknamearray.length) {
          let row2 = document.createElement("tr");
          let th = document.createElement("th");
          let td = document.createElement("td");
          th.innerHTML = `<th>${userdata.banknamearray[b].BankName}</th>`;
          td.innerHTML = `<th>${userdata.banknamearray[b].currentbank}</th>`;
          myTable1.appendChild(row2);
          row2.appendChild(th);
          row2.appendChild(td);
          let table3bank = (myTable1.querySelector("#table3-bank").innerHTML = userdata.banknamearray[b].currentbank);

          b++;
        }
      } else {
      }

      if (userdata.calculationarray.Balance === undefined) {
        let myTable = document.getElementById("table2");
      } else {
        let myTable = document.getElementById("table2");
        let balance = document.getElementById("balance");
        balance.innerHTML = userdata.calculationarray.Balance;
        let table2bank1 = (myTable.querySelector("#table2-bank").innerHTML = userdata.calculationarray.totalbank);
        let table2cash1 = (myTable.querySelector("#table2-cash").innerHTML = userdata.calculationarray.totalcash);
        let table2saving1 = (myTable.querySelector("#table2-saving").innerHTML = userdata.calculationarray.totalsaving);
      }
    }


      let a = 0;
        while (a < transactionhistory.length) {
          let myTable1 = document.getElementById("table3");

          let table3cash = (myTable1.querySelector("#table3-cash").innerHTML = calculationarray.totalcash);
          let table3saving = (myTable1.querySelector("#table3-saving").innerHTML = calculationarray.totalsaving);
          const table = document.getElementById("table1");
          let row2 = document.createElement("tr");
          let th1 = document.createElement("th");
          let td1 = document.createElement("td");
          let td2 = document.createElement("td");
          let td3 = document.createElement("td");

          if (transactionhistory[a].type === "Income") {
            th1.innerHTML = `<th>${transactionhistory[a].type}</th>`;
            td1.innerHTML = `<th>${transactionhistory[a].BankName}</th>`;
            td2.innerHTML = `<th>${transactionhistory[a].Date}</th>`;
            td3.innerHTML = `<th>-$${transactionhistory[a].Ammount}</th>`;
            td3.style.color = "green";
            table.appendChild(row2);
            row2.appendChild(th1);
            row2.appendChild(td1);
            row2.appendChild(td2);
            row2.appendChild(td3);
          } else {
            th1.innerHTML = `<th>${transactionhistory[a].type}</th>`;
            td1.innerHTML = `<th>${transactionhistory[a].BankName}</th>`;
            td2.innerHTML = `<th>${transactionhistory[a].Date}</th>`;
            td3.innerHTML = `<th>-$${transactionhistory[a].Ammount}</th>`;
            td3.style.color = "red";

            table.appendChild(row2);
            row2.appendChild(th1);
            row2.appendChild(td1);
            row2.appendChild(td2);
            row2.appendChild(td3);
          }

          a++;
        }
        

    var data = [
      { x: "Income", value: othercalculation.Income },
      { x: "Expense", value: othercalculation.Expense },
    ];
    const element = document.getElementById("container-chart");
    let var3 = `<div id="container-chart"></div>`;
    element.innerHTML = var3;
    var chart = anychart.pie(data);
    chart.innerRadius("75%");
    var labels = chart.labels();
    labels.position("outside");
    labels.fontColor("#000000");
    chart.overlapMode(true);
    chart.insideLabelsOffset("-75%");
    chart.legend(false);
    chart.container("container-chart");
    chart.background().fill("#F3F3F3 ");

    chart.draw();

    console.log(banknamearray);
    


  });

  submitbtn.addEventListener("click", async () => {
    let bankname = document.getElementById("bank-name").value;
    let ammount = parseInt(document.getElementById("ammount").value);

    let myTable = document.getElementById("table2");
    let table2cash = parseInt(myTable.querySelector("#table2-cash").innerText);
    let table2saving = parseInt(myTable.querySelector("#table2-saving").innerHTML);
    let table2bank = parseInt(myTable.querySelector("#table2-bank").innerHTML);

    let myTable1 = document.getElementById("table3");

    let count = 0;
    if (bankname === "" || ammount === "") {
      window.alert("Please fill all the feilds");
    } else {
      banksarr.forEach(function (item, index) {
        if (item === bankname) {
          count = count + 1;
        }
      });

      if (count > 0) {
        window.alert("The bank is already added!");
      } else {
        banksarr.push(bankname);
        const bankvalue = banksarr.length - 1;
        const sel = document.getElementById("bank-select");
        const opt = document.createElement("option");
        const sel1 = document.getElementById("bank-select1");
        const opt1 = document.createElement("option");
        opt.text = bankname;
        sel.add(opt, sel.options[bankvalue]);
        opt1.text = bankname;
        sel1.add(opt1, sel1.options[bankvalue]);

        const table = document.getElementById("table3");
        let row2 = document.createElement("tr");
        let th = document.createElement("th");
        let td = document.createElement("td");
        th.innerHTML = `<th>${bankname}</th>`;
        td.innerHTML = `<th>${ammount}</th>`;

        table.appendChild(row2);
        row2.appendChild(th);
        row2.appendChild(td);

        let totalbank = ammount + table2bank;
        let newbalance = table2cash + totalbank;
        Number(balance);
        balance.innerHTML = `<h2>${newbalance}</h2>`;
        let table2bank1 = (myTable.querySelector("#table2-bank").innerHTML = totalbank);

        banknamearray.push({
          BankName: bankname,
          currentbank: ammount,
        });

        calculationarray = {
          totalbank: table2bank1,
          totalsaving: table2saving,
          totalcash: table2cash,
          Balance: newbalance,
        };

        const docRef = doc(db, "users/", useremail);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          console.log(docSnap.data());

          const data = {
            banksarr: banksarr,
            banknamearray: banknamearray,
            calculationarray: calculationarray,
          };

          updateDoc(docRef, data).then(() => {
            console.log("Document has been added successfully");
          });
        }
        console.log(banksarr);
      }
    }
  });

      
      document.getElementById("fa-user").addEventListener("click", function () {
    if (confirm("Are you sure you want to logout?") == true) {
      const auth = getAuth();
      signOut(auth)
        .then(async () => {
          localStorage.clear();
          window.location.replace("Login.html");
        })
        .catch((error) => {
          // An error happened.
        });
    }
  });

  document.getElementById("expen-add").addEventListener("click", async function addexpen() {
    const ammountin = document.getElementById("ammount-input");
    let ammountdb = parseInt(ammountin.value);
    let select = document.getElementById("bank-select");
    const expenseradio = document.getElementById("expenseradio");
    let expensehtml = parseInt(document.getElementById("expensevalue").innerText);
    let incomehtml = parseInt(document.getElementById("incomevalue").innerText);

    console.log(expensestorage, incomestorage);

    const divisonradio = document.querySelector('input[name="division"]:checked');
    const expenradio = document.querySelector('input[name="expandivision"]:checked');
    var value = select.options[select.selectedIndex].value;
    let selected = select.options[select.selectedIndex].text;
    let selected1 = select.selectedIndex;

    let myTable = document.getElementById("table2");
    let table2cash = Number(myTable.querySelector("#table2-cash").innerText);
    let table2saving = parseInt(myTable.querySelector("#table2-saving").innerText);
    let table2bank = parseInt(myTable.querySelector("#table2-bank").innerText);

    let myTable1 = document.getElementById("table3");

    let totalbalance = document.getElementById("balance");
    let date = new Date();
    let currentDate = date.toString();

    if (ammountin.value.length == 0 || divisonradio == null || expenradio == null || value == undefined) {
      window.alert("Please select all the feilds");
    } else {
      if (expenseradio.checked === true) {
        function expensevalidation() {
          if (expensestorage == 0) {
            let totalexpense = ammountdb + expensehtml;
            let expensehtml3 = (document.getElementById("expensevalue").innerHTML = `<h2>${totalexpense}</h2>`);
            console.log(totalexpense);
            othercalculation.Expense = totalexpense;
          } else {
            let totalexpense = ammountdb + expensestorage;
            let expensehtml3 = (document.getElementById("expensevalue").innerHTML = `<h2>${totalexpense}</h2>`);
            othercalculation.Expense = totalexpense;
          }
        }

        if (selected === "Cash") {
          let totalcash = table2cash - ammountdb;
          let newbalance = parseInt(table2bank) + totalcash + Number(table2saving);
          let table3cashupdate = table2cash - ammountdb;
          if (table3cashupdate < 0) {
            window.alert("The input ammount is more than the cash!");
          } else {
            totalbalance.innerHTML = `<h2>${newbalance}</h2>`;
            let table2cash1 = parseInt((myTable.querySelector("#table2-cash").innerHTML = totalcash));
            let table3cash1 = (myTable1.querySelector("#table3-cash").innerHTML = totalcash);

            banknamearray[0].currentcash = totalcash;

            calculationarray = {
              Balance: newbalance,
              totalbank: table2bank,
              totalsaving: table2saving,
              totalcash: table2cash1,
            };

            expensevalidation();
            transactioncall();
          }
        } else if (selected === "Savings") {
          let totalsaving = table2saving - ammountdb;
          let newbalance = Number(table2bank) + Number(totalsaving) + Number(table2cash);
          let table3savingupdate = table2saving - ammountdb;
          if (table3savingupdate < 0) {
            window.alert("The input ammount is more than the cash!");
          } else {
            totalbalance.innerHTML = `<h2>${newbalance}</h2>`;
            let table2saving1 = parseInt((myTable.querySelector("#table2-saving").innerHTML = totalsaving));
            let table3saving = (myTable1.querySelector("#table3-saving").innerHTML = table3savingupdate);

            banknamearray[1].currentsaving = totalsaving;
            calculationarray = {
              Balance: newbalance,
              totalbank: table2bank,
              totalsaving: totalsaving,
              totalcash: table2cash,
            };

            expensevalidation();
            transactioncall();
          }
        } else {
          console.log(selected);
          let table4 = document.getElementById("table3");
          let var1 = selected1;
          let var2 = banknamearray[var1].currentbank;
          Number(var1);
          let totalbank = table2bank - ammountdb;
          let newbalance = totalbank + table2cash + Number(table2saving);
          let table3bankupdate = var2 - ammountdb;

          banknamearray[var1].currentbank = table3bankupdate;
          calculationarray = {
            Balance: newbalance,
            totalbank: totalbank,
            totalsaving: table2saving,
            totalcash: table2cash,
          };

          if (table3bankupdate < 0) {
            window.alert("The input ammount is more than the selected bank!");
          } else {
            totalbalance.innerHTML = `<h2>${newbalance}</h2>`;
            let table2bank1 = (myTable.querySelector("#table2-bank").innerHTML = totalbank);

            var x = document.getElementById("table3").rows.length - 1;

            let c = 0;
            for (let i = 2; i < x; i++) {
              table4.deleteRow(x - c);
              c = c + 1;
            }
            let b = 2;
            while (b < banknamearray.length) {
              let row1 = document.createElement("tr");
              let th = document.createElement("th");
              let td = document.createElement("td");
              console.log(banknamearray);
              th.innerHTML = `<th>${banknamearray[b].BankName}</th>`;
              td.innerHTML = `<th>${banknamearray[b].currentbank}</th>`;
              table4.appendChild(row1);
              row1.appendChild(th);
              row1.appendChild(td);

              b++;
            }
            expensevalidation();
            transactioncall();
          }
        }
        const docRef = doc(db, "users/", useremail);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          console.log(docSnap.data());

          const data = {
            banknamearray: banknamearray,
            othercalculations: othercalculation,
            calculationarray: calculationarray,
            transactionhistory: transactionhistory,
          };

          updateDoc(docRef, data).then(() => {
            console.log("Document has been added successfully");
          });
        }
        function transactioncall() {
          const table = document.getElementById("table1");
          let row2 = document.createElement("tr");
          let th1 = document.createElement("th");
          let td1 = document.createElement("td");
          let td2 = document.createElement("td");
          let td3 = document.createElement("td");
          if (house.checked === true) {
            th1.innerHTML = `<th>House</th>`;
            td1.innerHTML = `<th>${value}</th>`;
            td2.innerHTML = `<th>${currentDate}</th>`;
            td3.innerHTML = `<th>-$${ammountdb}</th>`;
            td3.style.color = "red";
            table.appendChild(row2);
            row2.appendChild(th1);
            row2.appendChild(td1);
            row2.appendChild(td2);
            row2.appendChild(td3);

            transactionhistory.push({ BankName: value, Date: currentDate, Ammount: ammountdb, type: "Home" });
          } else if (gift.checked === true) {
            th1.innerHTML = `<th>Gift</th>`;
            td1.innerHTML = `<th>${value}</th>`;
            td2.innerHTML = `<th>${currentDate}</th>`;
            td3.innerHTML = `<th>-$${ammountdb}</th>`;
            td3.style.color = "red";
            table.appendChild(row2);
            row2.appendChild(th1);
            row2.appendChild(td1);
            row2.appendChild(td2);
            row2.appendChild(td3);

            transactionhistory.push({ BankName: value, Date: currentDate, Ammount: ammountdb, type: "Gift" });
          } else if (dinner.checked === true) {
            th1.innerHTML = `<th>Dinner</th>`;
            td1.innerHTML = `<th>${value}</th>`;
            td2.innerHTML = `<th>${currentDate}</th>`;
            td3.innerHTML = `<th>-$${ammountdb}</th>`;
            td3.style.color = "red";
            table.appendChild(row2);
            row2.appendChild(th1);
            row2.appendChild(td1);
            row2.appendChild(td2);
            row2.appendChild(td3);

            transactionhistory.push({ BankName: value, Date: currentDate, Ammount: ammountdb, type: "Dinner" });
          } else if (medical.checked === true) {
            th1.innerHTML = `<th>Medical</th>`;
            td1.innerHTML = `<th>${value}</th>`;
            td2.innerHTML = `<th>${currentDate}</th>`;
            td3.innerHTML = `<th>-${ammountdb}$</th>`;
            td3.style.color = "red";
            table.appendChild(row2);
            row2.appendChild(th1);
            row2.appendChild(td1);
            row2.appendChild(td2);
            row2.appendChild(td3);

            transactionhistory.push({ BankName: value, Date: currentDate, Ammount: ammountdb, type: "Medical" });
          } else {
            th1.innerHTML = `<th>Shopping</th>`;
            td1.innerHTML = `<th>${value}</th>`;
            td2.innerHTML = `<th>${currentDate}</th>`;
            td3.innerHTML = `<th>-${ammountdb}$</th>`;
            td3.style.color = "red";
            table.appendChild(row2);
            row2.appendChild(th1);
            row2.appendChild(td1);
            row2.appendChild(td2);
            row2.appendChild(td3);

            transactionhistory.push({ BankName: value, Date: currentDate, Ammount: ammountdb, type: "Shopping" });
          }
        }
      } else {
        function incomevalidation() {
          if (incomestorage == 0) {
            let totalincome = ammountdb + incomehtml;
            let incomehtml3 = (document.getElementById("incomevalue").innerHTML = `<h2>${totalincome}</h2>`);
            console.log(totalincome);
            othercalculation.Income = totalincome;
          } else {
            let totalincome = ammountdb + incomestorage;
            let incomehtml3 = (document.getElementById("incomevalue").innerHTML = `<h2>${totalincome}</h2>`);
            othercalculation.Income = totalincome;
          }
        }

        if (selected === "Cash") {
          let totalcash = table2cash + ammountdb;
          let newbalance = parseInt(table2bank) + totalcash + Number(table2saving);
          let table3cashupdate = table2cash + ammountdb;
          totalbalance.innerHTML = `<h2>${newbalance}</h2>`;
          let table2cash1 = parseInt((myTable.querySelector("#table2-cash").innerHTML = totalcash));
          let table3cash1 = (myTable1.querySelector("#table3-cash").innerHTML = totalcash);

          banknamearray[0].currentcash = totalcash;

          calculationarray = {
            Balance: newbalance,
            totalbank: table2bank,
            totalsaving: table2saving,
            totalcash: table2cash1,
          };

          incomevalidation();
          transactioncall();
        } else if (selected === "Savings") {
          let totalsaving = table2saving + ammountdb;
          let newbalance = Number(table2bank) + Number(totalsaving) + Number(table2cash);
          let table3savingupdate = table2saving + ammountdb;
          totalbalance.innerHTML = `<h2>${newbalance}</h2>`;
          let table2saving1 = parseInt((myTable.querySelector("#table2-saving").innerHTML = totalsaving));
          let table3saving = (myTable1.querySelector("#table3-saving").innerHTML = table3savingupdate);

          banknamearray[1].currentsaving = totalsaving;
          calculationarray = {
            Balance: newbalance,
            totalbank: table2bank,
            totalsaving: totalsaving,
            totalcash: table2cash,
          };

          incomevalidation();
          transactioncall();
        } else {
          console.log(selected);
          let myTable1 = document.getElementById("table3");
          let var1 = selected1;
          let var2 = banknamearray[var1].currentbank;
          Number(var1);
          let totalbank = table2bank + ammountdb;
          let newbalance = totalbank + table2cash + Number(table2saving);
          let table3bankupdate = var2 + ammountdb;
          totalbalance.innerHTML = `<h2>${newbalance}</h2>`;
          let table2bank1 = (myTable.querySelector("#table2-bank").innerHTML = totalbank);

          banknamearray[var1].currentbank = table3bankupdate;
          calculationarray = {
            Balance: newbalance,
            totalbank: totalbank,
            totalsaving: table2saving,
            totalcash: table2cash,
          };
          let table4 = document.getElementById("table3");

          var x = document.getElementById("table3").rows.length - 1;

          let c = 0;
          for (let i = 2; i < x; i++) {
            table4.deleteRow(x - c);
            c = c + 1;
          }
          let b = 2;
          while (b < banknamearray.length) {
            let row1 = document.createElement("tr");
            let th = document.createElement("th");
            let td = document.createElement("td");
            console.log(banknamearray);
            th.innerHTML = `<th>${banknamearray[b].BankName}</th>`;
            td.innerHTML = `<th>${banknamearray[b].currentbank}</th>`;
            table4.appendChild(row1);
            row1.appendChild(th);
            row1.appendChild(td);

            b++;
          }
          incomevalidation();
          transactioncall();
        }
        function transactioncall() {
          const table = document.getElementById("table1");
          let row2 = document.createElement("tr");
          let th1 = document.createElement("th");
          let td1 = document.createElement("td");
          let td2 = document.createElement("td");
          let td3 = document.createElement("td");
     
            th1.innerHTML = `<th>Income</th>`;
        td1.innerHTML = `<th>${value}</th>`;
        td2.innerHTML = `<th>${currentDate}</th>`;
        td3.innerHTML = `<th>$${ammountin.value}</th>`;
        td3.style.color = "green";
        table.appendChild(row2);
        row2.appendChild(th1);
        row2.appendChild(td1);
        row2.appendChild(td2);
        row2.appendChild(td3);

       transactionhistory.push({ BankName: value, Date: currentDate, Ammount: ammountdb, type: "Income" });
      
          
        }
      }
      const docRef = doc(db, "users/", useremail);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        console.log(docSnap.data());

        const data = {
          banknamearray: banknamearray,
          othercalculations: othercalculation,
          calculationarray: calculationarray,
          transactionhistory:transactionhistory
        };

        updateDoc(docRef, data).then(() => {
          console.log("Document has been added successfully");
        });
      }
    }




    var data = [
      { x: "Income", value: othercalculation.Income },
      { x: "Expense", value: othercalculation.Expense },
    ];
    const element = document.getElementById("container-chart");
    let var3 = `<div id="container-chart"></div>`;
    element.innerHTML = var3;
    var chart = anychart.pie(data);
    chart.innerRadius("75%");
    var labels = chart.labels();
    labels.position("outside");
    labels.fontColor("#000000");
    chart.overlapMode(true);
    chart.insideLabelsOffset("-75%");
    chart.legend(false);
    chart.container("container-chart");
    chart.background().fill("#F3F3F3 ");

    chart.draw();

  });
</script>
